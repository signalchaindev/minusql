{"version":3,"file":"index.es.js","sources":["../src/utils/rimraf.js","../src/utils/print_elapsed.js","../src/config.js","../src/buildSchemaAssets.js"],"sourcesContent":["import fs from \"fs\"\nimport path from \"path\"\nimport kleur from \"kleur\"\n\nexport function rimraf(entry_path) {\n  if (!entry_path) {\n    throw new Error(kleur.red(\"rimraf requires a path to a directory or file\"))\n  }\n\n  if (!fs.existsSync(entry_path)) {\n    return\n  }\n\n  const stats = fs.statSync(entry_path)\n\n  if (stats.isDirectory()) {\n    fs.readdirSync(entry_path).forEach(entry => {\n      rimraf(path.join(entry_path, entry))\n    })\n\n    fs.rmdirSync(entry_path)\n    return\n  }\n\n  fs.unlinkSync(entry_path)\n}\n","import { performance } from \"perf_hooks\"\nimport kleur from \"kleur\"\n\n/**\n * @param {number} start\n * @param {string} msg\n */\nexport function print_elapsed(start, msg) {\n  const end = performance.now()\n  let elapsed = end - start\n  let unit = \"ms\"\n  if (elapsed >= 1000) {\n    elapsed = elapsed * 0.001\n    unit = \"s\"\n  }\n  console.log(\n    `${kleur.blue(msg)} ${kleur.green(\"in\")} ${kleur.blue(\n      elapsed.toFixed(1),\n    )}${kleur.blue(unit)}`,\n  )\n}\n","import os from \"os\"\nimport path from \"path\"\n\nexport const binName = \"tempo\"\nexport const binBuildDir = path.join(process.cwd(), \".bin\")\nexport const packageDir = path.join(process.cwd(), \"src\", \"package\")\nexport const exeName = `${binName}.exe`\nexport const moduleBinDir = path.join(\n  process.cwd(),\n  \"node_modules\",\n  \"tempo\",\n  \".bin\",\n)\nexport const moduleBuildDir = path.join(process.cwd(), \"src\", \"node_modules\")\nexport const modulePackageDir = path.join(\n  process.cwd(),\n  \"node_modules\",\n  \"tempo\",\n  \"src\",\n  \"package\",\n)\nexport const moduleTempDirPath = path.join(\n  process.cwd(),\n  \"node_modules\",\n  \"tempo\",\n  \"temp\",\n)\n\n// Mapping from Node's `process.arch` to Golang's `$GOARCH`\nconst ARCH_MAPPING = {\n  ia32: \"386\",\n  x64: \"amd64\",\n  arm: \"arm\",\n}\n\n// Mapping between Node's `process.platform` to Golang's\nconst PLATFORM_MAPPING = {\n  darwin: \"darwin\",\n  linux: \"linux\",\n  win32: \"windows\",\n  freebsd: \"freebsd\",\n}\n\nexport const goos = PLATFORM_MAPPING[os.platform()]\nexport const goarch = ARCH_MAPPING[os.arch()]\nexport const subDir = `${goos}-${goarch}`\n","import fs from \"fs\"\nimport path from \"path\"\nimport { promisify } from \"util\"\nimport child_process from \"child_process\"\nimport { performance } from \"perf_hooks\"\nimport kleur from \"kleur\"\nimport { mergeTypeDefs } from \"@graphql-tools/merge\"\nimport { print } from \"graphql\"\nimport { rimraf } from \"./utils/rimraf.js\"\nimport { print_elapsed } from \"./utils/print_elapsed.js\"\nimport { moduleBinDir, moduleTempDirPath, binName, subDir } from \"./config.js\"\n\nconst exec = promisify(child_process.exec)\n\n/**\n * Run the Go binary to build the resolver map and concatenate graphql files\n * Runs from the node_modules directory of the project\n */\nexport async function buildSchemaAssets(options = {}, actions) {\n  const opts = {\n    dev: options.dev || false,\n    dir: options.dir || \"src\",\n  }\n\n  // Run Go binary\n  // TODO: exec calls take around 200ms. convert to wasm when possible.\n  const { stdout, stderr } = await exec(\n    `${binName} ${process.cwd()} ${opts.dir} ${actions.ext}`,\n    {\n      cwd: path.join(moduleBinDir, subDir),\n    },\n  )\n  const numbers = stdout.match(/[\\d.]+/g)\n  const letters = stdout.match(/[a-z]+/gi)\n  console.log(\n    `${kleur.blue(\"[tempo] Compile schema\")} ${kleur.green(\"in\")} ${kleur.blue(\n      parseFloat(numbers).toFixed(1) + letters,\n    )}`,\n  )\n  if (stderr) {\n    console.error(kleur.red(`Error: ${stderr}`))\n  }\n\n  if (actions.ext === \".graphql\" || actions.ext === \"any\") {\n    const start = performance.now()\n    const typeDefsTempPath = path.join(moduleTempDirPath, \"typeDefs.graphql\")\n    const typeDefsPath = path.join(\n      process.cwd(),\n      \"src\",\n      \"node_modules\",\n      \"@tempo\",\n      \"typeDefs.js\",\n    )\n    rimraf(typeDefsPath)\n    const unmergedTypeDefs = fs.readFileSync(typeDefsTempPath, \"utf-8\")\n    const typeDefs = mergeTypeDefs([unmergedTypeDefs])\n    const printedTypeDefs = print(typeDefs)\n    fs.writeFileSync(\n      typeDefsPath,\n      `export const typeDefs = \\`${printedTypeDefs}\\``,\n      \"utf-8\",\n    )\n    print_elapsed(start, \"[tempo] Build type defs\")\n  }\n}\n"],"names":[],"mappings":"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"}